<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Full-Stack App (Student Build)</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>
  <nav class="navbar" style="background-color:#126cac;">
    <div class="container">
      <!-- Left side brand -->
      <a class="navbar-brand fw-bold text-white" href="#" id="navBrand">Full-Stack App</a>

      <!-- Right side links -->
      <div class="d-flex  align-items-center gap-3 ms-auto">
        <div id="authLinks" class="d-flex align-items-center gap-2">
          <a href="#" id="navLogin" class="nav-link text-white fw-semibold">Login</a>
          <a href="#" id="navRegister" class="nav-link text-white fw-semibold">Register</a>
        </div>

        <div id="userDropdown" class="dropdown d-none">
          <button class="btn btn-info dropdown-toggle" id="userDropdownToggle" type="button"
            aria-expanded="false">
            User
          </button>
          <ul class="dropdown-menu dropdown-menu-end" id="userDropdownMenu">
            <li><a class="dropdown-item" href="#" id="ddProfile">Profile</a></li>
            <li><a class="dropdown-item" href="#" id="ddEmployees">Employees</a></li>
            <li><a class="dropdown-item" href="#" id="ddAccounts">Accounts</a></li>
            <li><a class="dropdown-item" href="#" id="ddDepartments">Departments</a></li>
            <li><a class="dropdown-item" href="#" id="ddRequests">My Requests</a></li>
            <li>
              <hr class="dropdown-divider">
            </li>
            <li><a class="dropdown-item text-danger" href="#" id="ddLogout">Logout</a></li>
          </ul>
        </div>
      </div>
    </div>
  </nav>


  <main class="container py-5">
    <section id="homeSection">
      <h1 class="display-5 fw-bold">Welcome to Full-Stack App</h1>
      <p class="text-muted">
        A static prototype before backend integration. Simulates:
      </p>


      <ul>
        <li>Email registration + fake verification</li>
        <li>Login with JWT-like token simulation</li>
        <li>Role-based UI (Admin/User)</li>
        <li>CRUD for Employees, Departments, Requests</li>
      </ul>


      <div class="alert alert-warning d-flex align-items-center mt-4" role="alert">
        <span class="me-2">!</span>
        <div>
          <strong>Note:</strong> This demo uses a simple in-memory backend and a session token.
        </div>
      </div>


      <a class="btn btn-primary btn-lg" href="#get-started">
        Get Started â†’
      </a>
    </section>


    <section id="registerSection" class="d-none">

      <h2 class="mt-4" id="register">Register Account</h2>
      <form id="registerForm" class="mt-4" style="max-width: 420px;">
        <div class="mb-3">
          <label class="form-label">First Name</label>
          <input type="text" class="form-control" id="regFirstName" required>
        </div>
        <div class="mb-3">
          <label class="form-label">Last Name</label>
          <input type="text" class="form-control" id="regLastName" required>
        </div>
        <div class="mb-3">
          <label class="form-label">Email</label>
          <input type="email" class="form-control" id="regEmail" required>
        </div>

        <div class="mb-3">
          <label class="form-label">Password</label>
          <input type="password" class="form-control" id="regPassword" required>
        </div>
        <div class="d-grid gap-3 d-md-block">
          <button type="submit" class="btn btn-primary mt-2 me-2">Register</button>
          <button type="button" id="cancelRegister" class="btn btn-outline-secondary mt-2">Cancel</button>
        </div>

      </form>

      <div id="registerAlert" class="mt-3"></div>
    </section>

    <section id="loginSection" class="d-none">
      <h2 class="mt-4" id="login"> Login</h2>
      <form id="loginForm" style="max-width: 400px;" class="mt-4 ">
        <div class="mb-3">
          <label class="form-label">Username</label>
          <input type="text" class="form-control" id="loginEmail" required>
        </div>
        <div class="mb-3">
          <label class="form-label">Password</label>
          <input type="password" class="form-control" id="loginPassword" required>
        </div>
        <div class="d-grid gap-3 d-md-block">
          <button type="submit" class="btn btn-primary mt-2 me-2">Login</button>
          <button type="button" id="cancelLogin" class="btn btn-outline-secondary mt-2">Cancel</button>
        </div>
      </form>
      <div id="loginAlert" class="mt-3"></div>
    </section>

    <section id="profileSection" class="d-none">
      <h2 class="mt-4">My Profile </h2>
      <div class=" card p-4" style="max-width: 400px;">
        <div id="profileName" class="fw-bold">Admin user</div>
        <div>
          <strong>Email:</strong> <span id="profileEmail">admin@example</span>
        </div>
        <div>
          <strong>Role:</strong> <span id="profileRole">Admin</span>
        </div>
        <button class="btn btn-outline-primary mt-3" id="editProfileBtn">Edit Profile</button>
      </div>
    </section>
  </main>
  <script>
  const homeSection = document.getElementById("homeSection");
  const registerSection = document.getElementById("registerSection");
  const loginSection = document.getElementById("loginSection");

  const registerForm = document.getElementById("registerForm");
  const firstNameInput = document.getElementById("regFirstName");
  const lastNameInput = document.getElementById("regLastName");
  const emailInput = document.getElementById("regEmail");
  const passwordInput = document.getElementById("regPassword");
  const alertDiv = document.getElementById("registerAlert");

  const loginForm = document.getElementById("loginForm");
  const loginEmailInput = document.getElementById("loginEmail");
  const loginPasswordInput = document.getElementById("loginPassword");
  const loginAlert = document.getElementById("loginAlert");

  const profileSection = document.getElementById("profileSection");
  const profileName = document.getElementById("profileName");
  const profileEmail = document.getElementById("profileEmail");
  const profileRole = document.getElementById("profileRole");
  const editProfileBtn = document.getElementById("editProfileBtn");
  const navBrand = document.getElementById("navBrand");
  const authLinks = document.getElementById("authLinks");
  const userDropdown = document.getElementById("userDropdown");
  const userDropdownToggle = document.getElementById("userDropdownToggle");
  const userDropdownMenu = document.getElementById("userDropdownMenu");
  const ddProfile = document.getElementById("ddProfile");
  const ddEmployees = document.getElementById("ddEmployees");
  const ddAccounts = document.getElementById("ddAccounts");
  const ddDepartments = document.getElementById("ddDepartments");
  const ddRequests = document.getElementById("ddRequests");
  const ddLogout = document.getElementById("ddLogout");

  const AUTH_TOKEN_KEY = "authToken";
  let loggedInUser = null;

  async function login(username, password) {
    try {
      const response = await fetch('http://localhost:5500/api/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username, password })
      });

      const data = await response.json();

      if (response.ok) {
        sessionStorage.setItem('authToken', data.token);
        showDashboard(data.user);
      } else {
        alert('Login failed: ' + (data.error || 'Unknown error'));
      }
    } catch (err) {
      alert('Network error');
    }
  }

  function showDashboard(user) {
    applyAuthState(user);
    showSection(profileSection);
    loadProfile();
  }

  function getAuthHeader() {
    const token = sessionStorage.getItem('authToken');
    return token ? { Authorization: `Bearer ${token}` } : {};
  }

  async function loadAdminDashboard() {
    const res = await fetch('http://localhost:5500/api/admin/dashboard', {
      headers: getAuthHeader()
    });
    if (res.ok) {
      const data = await res.json();
      document.getElementById('content').innerText = data.message;
    } else {
      document.getElementById('content').innerText = 'Access denied!';
    }
  }

  function setUserMenuVisibility(isVisible) {
    userDropdown.classList.toggle("d-none", !isVisible);
    authLinks.classList.toggle("d-none", isVisible);
  }

  function setAdminLinksVisible(isAdmin) {
    const adminLinks = [ddEmployees, ddAccounts, ddDepartments];
    adminLinks.forEach(link => link.classList.toggle("d-none", !isAdmin));
  }

  function applyAuthState(user) {
    loggedInUser = user;
    if (loggedInUser) {
      userDropdownToggle.textContent = loggedInUser.role || "User";
      setUserMenuVisibility(true);
      setAdminLinksVisible(loggedInUser.role === "admin");
    } else {
      userDropdownToggle.textContent = "User";
      setUserMenuVisibility(false);
      setAdminLinksVisible(false);
    }
  }

  async function tryRestoreSession() {
    const token = sessionStorage.getItem(AUTH_TOKEN_KEY);
    if (!token) return;

    try {
      const response = await fetch('/api/profile', {
        headers: { Authorization: `Bearer ${token}` }
      });
      const data = await response.json();

      if (response.ok && data.user) {
        applyAuthState({
          username: data.user.username,
          role: data.user.role
        });
      } else {
        sessionStorage.removeItem(AUTH_TOKEN_KEY);
      }
    } catch {
      sessionStorage.removeItem(AUTH_TOKEN_KEY);
    }
  }

  applyAuthState(null);


  registerForm.addEventListener('submit', async (e) => {
    e.preventDefault();

    const firstName = firstNameInput.value.trim();
    const lastName = lastNameInput.value.trim();
    const email = emailInput.value.trim();
    const password = passwordInput.value.trim();

    if (firstName && lastName && email && password) {
      alertDiv.innerHTML = '<div class="alert alert-info">Registering...</div>';

      const response = await fetch('/api/register', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          username: email,
          password,
          role: 'user',
          firstName,
          lastName
        })
      });

      const data = await response.json();

      if (response.ok) {
        alertDiv.innerHTML = `<div class="alert alert-success"><strong>Success!</strong> ${data.message || 'Registered.'}</div>`;
        registerForm.reset();

        setTimeout(() => {
          showSection(loginSection);
          alertDiv.innerHTML = '';
        }, 2000);
      } else {
        alertDiv.innerHTML = `<div class="alert alert-danger"><strong>Error!</strong> ${data.error || data.message || 'Registration failed.'}</div>`;
      }
    }
  });

  function showSection(section) {
    homeSection.classList.add("d-none");
    registerSection.classList.add("d-none");
    loginSection.classList.add("d-none");
    profileSection.classList.add("d-none");


    section.classList.remove("d-none");
  }


  navBrand.onclick = (e) => {
    e.preventDefault();
    showSection(homeSection);
  };

  document.getElementById("navRegister").onclick = (e) => {
    e.preventDefault();
    showSection(registerSection);
  };


  document.getElementById("navLogin").onclick = (e) => {
    e.preventDefault();
    showSection(loginSection);
  };

  document.getElementById("cancelRegister").onclick = () => {
    showSection(homeSection);
  };

  document.getElementById("cancelLogin").onclick = () => {
    showSection(homeSection);
  };

  loginForm.addEventListener('submit', async (e) => {
    e.preventDefault();

    const email = loginEmailInput.value.trim();
    const password = loginPasswordInput.value.trim();

    if (!email || !password) return;

    loginAlert.innerHTML = '<div class="alert alert-info">Logging in...</div>';

    await login(email, password);
    loginAlert.innerHTML = '<div class="alert alert-success"><strong>Success!</strong> Login successful.</div>';
    loginForm.reset();
  });

  async function loadProfile() {
    if (!loggedInUser) return;
    const token = sessionStorage.getItem(AUTH_TOKEN_KEY);
    if (!token) return;
    const response = await fetch('/api/profile', {
      headers: { Authorization: `Bearer ${token}` }
    });
    const data = await response.json();

    if (response.ok && data.user) {
      const user = data.user;
      const username = user.username || loggedInUser.username || "";
      profileName.textContent = username || "User";
      profileEmail.textContent = username;
      profileRole.textContent = user.role || "User";
    } else {
      profileName.textContent = "User not found";
      profileEmail.textContent = "";
      profileRole.textContent = "";
    }
  }

  function toggleUserMenu() {
    const isOpen = userDropdownMenu.classList.contains("show");
    userDropdownMenu.classList.toggle("show", !isOpen);
    userDropdownToggle.setAttribute("aria-expanded", String(!isOpen));
  }

  userDropdownToggle.onclick = (e) => {
    e.preventDefault();
    toggleUserMenu();
  };

  document.addEventListener("click", (e) => {
    if (!userDropdown.contains(e.target)) {
      userDropdownMenu.classList.remove("show");
      userDropdownToggle.setAttribute("aria-expanded", "false");
    }
  });

  ddProfile.onclick = async (e) => {
    e.preventDefault();
    if (!loggedInUser) return;
    showSection(profileSection);
    await loadProfile();
  };

  const comingSoon = (e) => {
    e.preventDefault();
    alert("Feature coming soon!");
  };

  ddEmployees.onclick = comingSoon;
  ddAccounts.onclick = comingSoon;
  ddDepartments.onclick = comingSoon;
  ddRequests.onclick = comingSoon;

  ddLogout.onclick = (e) => {
    e.preventDefault();
    sessionStorage.removeItem(AUTH_TOKEN_KEY);
    applyAuthState(null);
    showSection(homeSection);
  };

  editProfileBtn.onclick = () => {
    alert("Edit Profile feature coming soon!");
  };

  window.addEventListener("load", tryRestoreSession);
</script>

</body>

</html>

